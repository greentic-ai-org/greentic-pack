# Publishing to crates.io

This repository ships three distributable crates:

- `greentic-pack` – the CLI used to build Greentic packs
- `greentic-pack-lib` – the builder/reader library used by the CLI
- `pack_component` – the Wasm component library generated by the builder

Publishing flow:

1. Ensure `CARGO_REGISTRY_TOKEN` is configured in GitHub secrets with publish
   rights for the `greentic-*` organisation.
2. Create and push a tag of the form `vX.Y.Z`. The automated workflow
   `.github/workflows/publish.yml` will run `cargo publish` for both crates in
   dependency order.
3. Wait for the job to finish. Published versions are immutable; if a release
   fails, yank the partial upload and bump the patch version before re-tagging.
4. Tag pushes also build release binaries for `greentic-pack` and upload them
   to the corresponding GitHub release with `cargo-binstall` metadata, so users
   can install via `cargo binstall greentic-pack`.

Local dry-run before tagging:

```bash
cargo publish -p pack_component --dry-run
cargo publish -p greentic-pack-lib --dry-run
cargo publish -p greentic-pack --dry-run
```

The component crate and `greentic-pack-lib` should be published before the CLI
so the dependency graph resolves correctly for downstream users.
